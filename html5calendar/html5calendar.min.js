/*!
 * HTML5Calendar v0.0.1-alpha1
 * Docs & License: https://github.com/scottpledger/html5calendar
 * (c) 2014 Scott Pledger
 */
(function(t){"function"==typeof define&&define.amd?define(["jquery","moment"],t):t(jQuery,moment)})(function(t,e){var a;a=function(a){function s(a,n){this.element=t(a),this.options=t.extend(!0,{},s.defaultOptions,n,s._getOptsFromElement(this.element)),this.element.addClass("html5calendar"),this.weekOffset=0,this.today=e(),this.defaultDate="today"==this.options.date?e():e(this.options.defaultDate),this.innerElement=this.element.find(".ht5c-inner"),0===this.innerElement.length&&(this.innerElement=t('<div class="ht5c-inner"></div>'),this.element.append(this.innerElement)),this.viewContainer=t('<div class="ht5c-view"></div>'),this.weeksList=t('<ul class="ht5c-weeks"></ul>'),this.hourRows=t('<ul class="ht5c-hours"><li></li></ul>'),this.days={},this.weeks={},this.colWidth=100/this.options.daysPerWeek,this.hourHeight=0,this.innerElement.append(this.hourRows),this.innerElement.append(this.viewContainer),this.viewContainer.append(this.weeksList),this.eventData=this.element.find("[data-calendar-events]"),this.today.startOf("day"),this._initButtons(),this._parseEvents(),this.innerElement.removeClass("agenda basic month").addClass(this.options.type),this.element.removeClass("ht5c-agenda ht5c-basic ht5c-month").addClass("ht5c-"+this.options.type),this.render(),this._mouseInit()}return s.prototype._setOption=function(){},s.prototype._initButtons=function(){var e=this;this.element.find("[data-calendar-action]").on("click",function(){var a=t(this);e.element.html5calendar(a.attr("data-calendar-action"))}),this.element.find("[data-calendar-option]").on("click",function(){var a=t(this);e.element.html5calendar("option",a.attr("data-calendar-option"),a.attr("data-calendar-optionValue"))})},s.prototype._parseEvents=function(){var t=this,a=e.duration(this.options.dayBegin),s=e.duration(this.options.dayEnd),i=s.subtract(a).asHours();this._hourBegin=a,this._hourEnd=s,this._maxHeight=i,this.innerElement.removeClass("days-1 days-2 days-3 days-4 days-5 days-6 days-7").addClass("days-"+this.options.daysPerWeek),this.eventData.children("li").each(function(e,a){var s=new n(a);t._placeEvent(s)})},s.prototype._placeEvent=function(e){var a=e.makeSegments("days"),n=this;a.each(function(e,a){var s,i,r,o,h=t(a);h.appendTo(n._getDay(h.data("range").start)),s=h.data("dimensions"),i=s.top-n._hourBegin.asHours(),r=s.height,0>i&&(i=0,r+=i),r=Math.min(n._maxHeight,r),o={top:i+"em",height:r+"em"},h.data("css",o),h.css("agenda"==n.options.view?o:{top:"0em",height:"auto"})}),e.redraw()},s.prototype.render=function(){},s._getOptsFromElement=function(t){var e,n={};for(var i in s.defaultOptions)e=t.attr("data-calendar-"+i.toLowerCase()),e!==a&&(n[i]=e);return n},s.defaultOptions={defaultTimedEventDuration:"02:00:00",defaultAllDayEventDuration:{days:1},forceEventDuration:!1,nextDayThreshold:"05:00:00",view:"month",eventSources:["[data-calendar-events]"],weekends:!0,lazyFetching:!0,startParam:"start",endParam:"end",timezoneParam:"timezone",titleFormat:{month:"MMMM YYYY",week:"ll",day:"LL"},columnFormat:{month:"ddd",week:"ddd M/D",day:"dddd"},timeFormat:{"default":"h:mm a"},isRTL:!1,selectable:!1,unselectAuto:!0,dropAccept:"*",handleWindowResize:!0},s}();var n;n=function(){function a(n){var s,i,r;for(r in a.defaults)this[r]=a.defaults[r];if(t.isPlainObject(n)){for(r in n)"start"==r?s=n[r]:"end"==r?i=n[r]:this[r]=n[r];this.element=t("<li></li>")}else{if("object"!=t.type(t(n)[0]))throw Error("Invalid Event!");var o,h,d=t(n),l=d[0].attributes;if(d.data("event")&&null!=d.data("event"))return d.data("event");for(var r=0;l.length>r;r++)o=l[r],o.name.slice(0,a.attrPrefix.length)==a.attrPrefix&&(h=o.name.slice(a.attrPrefix.length),"start"==h?s=o.value:"end"==h?i=o.value:this[o.name.slice(a.attrPrefix.length)]=o.value);this.element=d,d.attr("draggable")?(d.attr("draggable",!1),this.movable=!0):this.movable=!1,d.attr("resizable")?(d.attr("resizable",!1),this.resizable=!0):this.resizable=!1}if(s=e(s),i=e(i),!s.isValid())throw Error("Invalid Event!");if(this.start=s,i.isValid()&&(this.end=i,this.end.isBefore(this.start)))throw Error("Invalid Event!");this.allDay&&(this.start.startOf("day"),this.end=e(s).endOf("day")),this.html&&this.element.html(this.html),this.resizable&&this.element.append('<hr class="ht5c-event-resizeHandle">'),this.element.addClass("ht5c-event"),this.element.data("event",this),this._segments=[]}return a.prototype=e.range(0,1),a.prototype.constructor=a,a.attrPrefix="data-calendar-event-",a.prototype._rmSegments=function(){t(this._segments).each(function(e,a){t(a).remove()}),this._segments=[]},a.prototype._getSegment=function(){var t=this.element.clone();return t.data("event",this),this._segments.push(t),t},a.prototype.makeSegments=function(a){this._rmSegments();var n,s,i,r,o,h,d=this.chunk("into"+a);this.element.find('[data-calendar-event-receive="timeSpan"]').html(this.format());for(n in d)s=d[n],o=s.start,h=s.end,i=this._getSegment(),r=o.diff(e(o).startOf("day"),"hours",!0),i.data("range",s),i.data("dimensions",{top:r,height:h.diff(o,"hours",!0)});return t(this._segments)},a.prototype.redraw=function(){this.element.find('[data-calendar-event-receive="timeSpan"]').html(this.format()),t(this._segments).find('[data-calendar-event-receive="timeSpan"]').html(this.format())},a.prototype.clone=function(){var t,e,n=this.element.clone();n.attr("data-calendar-event-start",this.start.format()),n.attr("data-calendar-event-end",this.end.format()),n.attr("data-calendar-event-allDay",this.allDay),t=new a(n);for(e in this._segments)t._segments.push(this._segments[e].clone());return t},a.prototype.show=function(){t(this._segments).each(function(e,a){t(a).css("display","block")})},a.prototype.hide=function(){t(this._segments).each(function(e,a){t(a).css("display","none")})},a.prototype.addClass=function(){return t.fn.addClass.apply(this.element,Array.prototype.slice.apply(arguments,[0])),t.fn.addClass.apply(t(this._segments),Array.prototype.slice.apply(arguments,[0])),this},a.prototype.removeClass=function(){return t.fn.removeClass.apply(this.element,Array.prototype.slice.apply(arguments,[0])),t.fn.removeClass.apply(t(this._segments),Array.prototype.slice.apply(arguments,[0])),this},a.prototype.add=function(){this.start.add(arguments[0],arguments[1]),this.end.add(arguments[0],arguments[1])},a.prototype.update=function(){},a.prototype.remove=function(){this.element.remove(),t(this._segments).each(function(e,a){t(a).remove()})},a.defaults={allDay:!1},a}(),t.fn.html5calendar=function(){var e=arguments[0];return 1==this.length?(this.data("html5calendar")||this.data("html5calendar",new a(this,e)),this.data("html5calendar")):(this.each(function(){t(this).html5calendar(e)}),void 0)},t('[data-calendar="html5"]').html5calendar()});