/*!
 * HTML5Calendar v0.0.1-alpha1
 * Docs & License: https://github.com/scottpledger/html5calendar
 * (c) 2014 Scott Pledger
 */
(function(t){"function"==typeof define&&define.amd?define(["jquery","moment"],t):t(jQuery,moment)})(function(t,e){var a;a=function(a){function s(a,n){this.element=t(a),this.options=t.extend(!0,{},s.defaultOptions,n,s._getOptsFromElement(this.element)),this.element.addClass("html5calendar"),this.weekOffset=0,this.today=e(),this.defaultDate="today"==this.options.date?e():e(this.options.defaultDate),this.innerElement=this.element.find(".ht5c-inner"),0===this.innerElement.length&&(this.innerElement=t('<div class="ht5c-inner"></div>'),this.element.append(this.innerElement)),this.viewContainer=t('<div class="ht5c-view"></div>'),this.weeksList=t('<ul class="ht5c-weeks"></ul>'),this.hourRows=t('<ul class="ht5c-hours"><li></li></ul>'),this.days={},this.weeks={},this.colWidth=100/this.options.daysPerWeek,this.hourHeight=0,this.innerElement.append(this.hourRows),this.innerElement.append(this.viewContainer),this.viewContainer.append(this.weeksList),this.eventData=this.element.find("[data-calendar-events]"),this.today.startOf("day"),r._initButtons(this),r._parseEvents(this),this.innerElement.removeClass("agenda basic month").addClass(this.options.type),this.element.removeClass("ht5c-agenda ht5c-basic ht5c-month").addClass("ht5c-"+this.options.type),this.render(),r._mouseInit(this)}var i={render:function(){r._layoutHourRows(this),r._updateView(this)},next:function(){var t=Array.prototype.slice.apply(arguments,[0]),e="month"==this.options.view?"months":"weeks";0===t.length?this.defaultDate.add(1,e):this.defaultDate.add.apply(this.defaultDate,t),r._updateView(this)},prev:function(){var t=Array.prototype.slice.apply(arguments,[0]),e="month"==this.options.view?"months":"weeks";0===t.length?this.defaultDate.subtract(1,e):this.defaultDate.subtract.apply(this.defaultDate,t),r._updateView(this)}},r={_initButtons:function(e){var a=e;e.element.find("[data-calendar-action]").on("click",function(){var e=t(this);a.element.html5calendar(e.attr("data-calendar-action"))}),e.element.find("[data-calendar-option]").on("click",function(){var e=t(this);a.element.html5calendar("option",e.attr("data-calendar-option"),e.attr("data-calendar-optionValue"))})},_parseEvents:function(t){var a=t,s=e.duration(t.options.dayBegin),i=e.duration(t.options.dayEnd),o=i.subtract(s).asHours();t._hourBegin=s,t._hourEnd=i,t._maxHeight=o,t.innerElement.removeClass("days-1 days-2 days-3 days-4 days-5 days-6 days-7").addClass("days-"+t.options.daysPerWeek),t.eventData.children("li").each(function(t,e){var s=new n(e);r._placeEvent(a,s)})},_placeEvent:function(e,a){var n=a.makeSegments("days"),s=e;n.each(function(e,a){var n,i,o,d,l=t(a);l.appendTo(r._getDay(s,l.data("range").start)),n=l.data("dimensions"),i=n.top-s._hourBegin.asHours(),o=n.height,0>i&&(i=0,o+=i),o=Math.min(s._maxHeight,o),d={top:i+"em",height:o+"em"},l.data("css",d),l.css("agenda"==s.options.view?d:{top:"0em",height:"auto"})}),a.redraw()},_getWeek:function(n,s){s=e(s).startOf("week");var i=s.format("YYYYww");if(n.weeks[i]!==a)return n.weeks[i];var o,d=t('<ul data-calendar-weekLabel="'+i+'" class="ht5c-days"></ul>'),l=t('<li class="ht5c-week"></li>');n.weeks[i]=d,d.data("date",s),l.data("diff",s.diff(e(n.today).startOf("week"),"weeks",!0)),l.append(d),r._populateWeek(n,d,s);for(o in n.weeks)if(o>i)return n.weeks[o].parent().before(l),d;return n.weeksList.append(l),d},_populateWeek:function(t,a,n){var s,i=e(n);for(s=0;t.options.daysPerWeek>s;s++)a.append(r._makeDay(t,i)),i.add(1,"days")},_makeDay:function(a,n){var s=e(n),i=s.format("YYYYDDDD"),r=r=s.format(a.options.dayLabelFormat),o=t('<ul data-calendar-dayLabel="'+r+'" class="ht5c-events"></ul>'),d=t('<li class="ht5c-day year-'+s.format("YYYY")+" month-"+s.format("M")+" day-"+s.format("D")+'"><time>'+r+"</time></li>");return d.append(o),a.days[i]=o,d},_getDay:function(t,n){var s=e(n).startOf("day"),i=s.format("YYYYDDDD"),o=r._getWeek(t,s);if(t.days[i]!==a)return t.days[i];var d=r._makeDay(t,s);o.append(d);for(k in o.days)k>dayLabel&&o.days[k].parent().before(d);return day},_layoutHourRows:function(a){var n=e(a.today).startOf("day").add(e.duration(a.options.dayBegin)),s=e.duration(a.options.slotDuration),i=e(n).startOf("day").add(e.duration(a.options.dayEnd)),r="",o=s.asHours(),d=0;for(a.hourSize=o;n.isBefore(i)&&100>d;){var l=t('<li class="ht5c-hour"></li>'),h="<time>"+n.format(a.options.rowLabelFormat)+"</time>";h!=r&&l.append(h),r=h,a.hourRows.append(l),l.css({top:d*o+"em",height:o+"em","line-height":o+"em"}),a.hourHeight=l.height(),n.add(s),d++}a.innerElement.data("hours-height",.5+d*o)},_layoutDays:function(t){var a,n=e(t.defaultDate),s=e(n),i=(e.duration(1,"day"),0);for(i=0;t.options.daysPerWeek>i;i++)a=r._getDay(t,s),t.dayHeight=a.parent("li").height(),s=e(s).add(1,"days")},_layoutWeeks:function(t){t.defaultDate.startOf("week").add(t.options.firstDay,"day"),r._layoutDays(t),t.innerElement.css("height",t.innerElement.data("hours-height")+"em")},_layoutMonths:function(t){var a=e(t.defaultDate),n=e(t.defaultDate).endOf("month"),s=1;for(t.defaultDate.startOf("month");t.defaultDate.isBefore(n);)r._layoutWeeks(t),t.defaultDate.add(1,"week"),s++;t.defaultDate=a,t.innerElement.css("height",s-1+"em")},_updateWeeks:function(t){var e;for(var a in t.weeks)e=t.weeks[a].parent(),e.css("agenda"==t.options.view?{left:100*e.data("diff")+"%",top:0}:{left:0,top:e.data("diff")+"em"})},_updateEvents:function(e){var a=e;e.innerElement.find("li.ht5c-event").each(function(e,n){var s=t(n);s.css("agenda"==a.options.view?s.data("css"):{top:"0em",height:"auto"})})},_updateView:function(t){var a=e(t.defaultDate);r._updateEvents(t),"agenda"==t.options.view?(t.element.find('[data-calender-receive="defaultDate"]').html(e.range(a.startOf("week"),e(a).add(t.options.daysPerWeek-1,"days")).format({__default__:["MMM D","MMM D YYYY"]})),r._layoutWeeks(t),r._updateWeeks(t),t.weeksList.css({top:0,left:e(t.today).startOf("week").diff(e(t.defaultDate).startOf("week"),"days")*t.colWidth+"%"})):"basic"==t.options.view?(t.element.find('[data-calender-receive="defaultDate"]').html(e.range(a,e(a).add(t.options.daysPerWeek,"days")).format({__default__:["MMM D","MMM D YYYY"]})),r._layoutWeeks(t),r._updateWeeks(t),t.weeksList.css({top:0,left:e(t.today).startOf("week").diff(e(t.defaultDate).startOf("week"),"days")*t.colWidth+"%"})):"month"==t.options.view&&(t.element.find('[data-calender-receive="defaultDate"]').html(a.format(t.options.monthLabel)),t.element.removeClass("month-1 month-2 month-3 month-4 month-5 month-6 month-7 month-8 month-9 month-10 month-11 month-12").addClass("month-"+t.defaultDate.format("M")),r._layoutMonths(t),r._updateWeeks(t),t.weeksList.css({left:0,top:e(t.today).startOf("week").diff(e(t.defaultDate).startOf("month").startOf("week"),"weeks")+"em"}))}};return t.extend(s.prototype,i),s._getOptsFromElement=function(t){var e,n={};for(var i in s.defaultOptions)e=t.attr("data-calendar-"+i.toLowerCase()),e!==a&&(n[i]=e);return n},s.defaultOptions={defaultTimedEventDuration:"02:00:00",defaultAllDayEventDuration:{days:1},forceEventDuration:!1,nextDayThreshold:"05:00:00",view:"month",eventSources:["[data-calendar-events]"],weekends:!0,lazyFetching:!0,startParam:"start",endParam:"end",timezoneParam:"timezone",titleFormat:{month:"MMMM YYYY",week:"ll",day:"LL"},columnFormat:{month:"ddd",week:"ddd M/D",day:"dddd"},timeFormat:{"default":"h:mm a"},isRTL:!1,selectable:!1,unselectAuto:!0,dropAccept:"*",handleWindowResize:!0},s}();var n;n=function(){function a(n){var s,i,r;for(r in a.defaults)this[r]=a.defaults[r];if(t.isPlainObject(n)){for(r in n)"start"==r?s=n[r]:"end"==r?i=n[r]:this[r]=n[r];this.element=t("<li></li>")}else{if("object"!=t.type(t(n)[0]))throw Error("Invalid Event!");var o,d,l=t(n),h=l[0].attributes;if(l.data("event")&&null!=l.data("event"))return l.data("event");for(var r=0;h.length>r;r++)o=h[r],o.name.slice(0,a.attrPrefix.length)==a.attrPrefix&&(d=o.name.slice(a.attrPrefix.length),"start"==d?s=o.value:"end"==d?i=o.value:this[o.name.slice(a.attrPrefix.length)]=o.value);this.element=l,l.attr("draggable")?(l.attr("draggable",!1),this.movable=!0):this.movable=!1,l.attr("resizable")?(l.attr("resizable",!1),this.resizable=!0):this.resizable=!1}if(s=e(s),i=e(i),!s.isValid())throw Error("Invalid Event!");if(this.start=s,i.isValid()&&(this.end=i,this.end.isBefore(this.start)))throw Error("Invalid Event!");this.allDay&&(this.start.startOf("day"),this.end=e(s).endOf("day")),this.html&&this.element.html(this.html),this.resizable&&this.element.append('<hr class="ht5c-event-resizeHandle">'),this.element.addClass("ht5c-event"),this.element.data("event",this),this._segments=[]}return a.prototype=e.range(0,1),a.prototype.constructor=a,a.attrPrefix="data-calendar-event-",a.prototype._rmSegments=function(){t(this._segments).each(function(e,a){t(a).remove()}),this._segments=[]},a.prototype._getSegment=function(){var t=this.element.clone();return t.data("event",this),this._segments.push(t),t},a.prototype.makeSegments=function(a){this._rmSegments();var n,s,i,r,o,d,l=this.chunk("into"+a);this.element.find('[data-calendar-event-receive="timeSpan"]').html(this.format());for(n in l)s=l[n],o=s.start,d=s.end,i=this._getSegment(),r=o.diff(e(o).startOf("day"),"hours",!0),i.data("range",s),i.data("dimensions",{top:r,height:d.diff(o,"hours",!0)});return t(this._segments)},a.prototype.redraw=function(){this.element.find('[data-calendar-event-receive="timeSpan"]').html(this.format()),t(this._segments).find('[data-calendar-event-receive="timeSpan"]').html(this.format())},a.prototype.clone=function(){var t,e,n=this.element.clone();n.attr("data-calendar-event-start",this.start.format()),n.attr("data-calendar-event-end",this.end.format()),n.attr("data-calendar-event-allDay",this.allDay),t=new a(n);for(e in this._segments)t._segments.push(this._segments[e].clone());return t},a.prototype.show=function(){t(this._segments).each(function(e,a){t(a).css("display","block")})},a.prototype.hide=function(){t(this._segments).each(function(e,a){t(a).css("display","none")})},a.prototype.addClass=function(){return t.fn.addClass.apply(this.element,Array.prototype.slice.apply(arguments,[0])),t.fn.addClass.apply(t(this._segments),Array.prototype.slice.apply(arguments,[0])),this},a.prototype.removeClass=function(){return t.fn.removeClass.apply(this.element,Array.prototype.slice.apply(arguments,[0])),t.fn.removeClass.apply(t(this._segments),Array.prototype.slice.apply(arguments,[0])),this},a.prototype.add=function(){this.start.add(arguments[0],arguments[1]),this.end.add(arguments[0],arguments[1])},a.prototype.update=function(){},a.prototype.remove=function(){this.element.remove(),t(this._segments).each(function(e,a){t(a).remove()})},a.defaults={allDay:!1},a}(),t.fn.html5calendar=function(){var e=arguments[0];return 1==this.length?(this.data("html5calendar")||this.data("html5calendar",new a(this,e)),this.data("html5calendar")):(this.each(function(){t(this).html5calendar(e)}),void 0)},t('[data-calendar="html5"]').html5calendar()});